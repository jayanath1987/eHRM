<html>
<head>
<meta http-equiv="Content-Type" content="text/xml;charset=utf-8" >
</head>
<body>
<?php
error_reporting(E_ALL); ini_set("display_errors", true);
include_once("source/nusoap/lib/nusoap.php");
ini_set ('soap.wsdl_cache_enabled', 0);
ini_set('memory_limit', -1);
ini_set('max_execution_time', 300);

$serverName = "FP-SERVER\SQLSERVERR2";
$connectionInfo = array( "Database"=>"KEICO_NEW", "UID"=>"sa", "PWD"=>"passward");
$conn = sqlsrv_connect( $serverName, $connectionInfo );
if( $conn === false ) {
    die( print_r( sqlsrv_errors(), true));
}
//$date=date('Y-m-d', strtotime('-32 days')).',';
//$date.=date('Y-m-d', strtotime('-33 days')).',';
//$date.=date('Y-m-d', strtotime('-32 days')).',';
//$date.=date('Y-m-d', strtotime('-31 days'));
//die(print_r($date));
//$sql = "SELECT * FROM vwEmpMaster";
$date=date('Y-m-d', strtotime('-2 days'));
//die(var_dump($date));
$sql = "SELECT 	Convert(varchar(10),k.EventDate, 120) as Date, Convert(varchar(10),k.EventTime, 108) as Time,m.NICnumber 
FROM History k,vwEmpMaster m
where k.UserID=m.EmpNo AND k.EventDate ='".$date."' AND m.NICnumber in ('765500931V',
'782543598V',
'585251178V',
'895320692V',
'606781067V',
'837050405V',
'727271538V',
'845651116V',
'551401928V',
'836603192V',
'883502159V',
'872071369V',
'787141978V',
'643590226V',
'645570588V',
'606110448V',
'717760069V',
'575673872V',
'727040714V',
'632712197V',
'583223045V',
'883430590V',
'555311273V',
'902284079V',
'580550983V',
'596370748V',
'623224740V',
'616010913V',
'582063150V',
'675123136V',
'831872241V',
'785473264V',
'670753328V',
'622554208V',
'772192207V',
'850103682V',
'566220946V',
'847901748V',
'660730079V',
'837782430V',
'657660140V',
'740180355V',
'563030313V',
'822310672V',
'698040408V',
'570121022V',
'660281428V',
'530820041V',
'815560787V',
'775663014V',
'630170230V',
'542511737V',
'651611750V',
'560880294V',
'628060088V',
'575121756V',
'646901880V',
'626182429V',
'580340989V',
'625775302V',
'586451006V',
'601480514V',
'568462971V',
'738501691V',
'572011704V',
'547092392V',
'563422157V',
'587470900V',
'645330986V',
'580462995V',
'637000071V',
'823142013V',
'711410830V',
'661171553V',
'888541136V',
'651910269V',
'726140901V',
'756090046V',
'628632588V',
'566900793V',
'600110157V',
'605240151X',
'616440071V',
'561990689V',
'608032207V',
'630642108V',
'561302154V',
'617250165V',
'640531886V',
'895400289V',
'736093561V',
'735403532V',
'851591001V',
'583322183V',
'865500335V',
'572531090V',
'861901874V',
'562171231V',
'756680404V',
'605100473V',
'560471653V',
'695292937V',
'541201637V',
'596160794V',
'616720694V',
'578622137V',
'617110113V',
'640201541V',
'603641663V',
'848371874V',
'578000925V',
'811561320V',
'647310087V',
'876411890V',
'708502561V',
'737511910V',
'828172689V',
'611611749V',
'857113632V',
'670290816V',
'616361066V',
'595053137V',
'770703034V',
'627100310V',
'701762428V',
'657322172V',
'753121781V',
'640234610V',
'555112017V',
'558602414V',
'585570281V',
'657481807V',
'542142839V',
'562170456V',
'606841108V',
'596230873V',
'618520528V',
'557590013V',
'810410728V',
'816141982V',
'773242658V',
'682180242V',
'600971263V',
'565131796V',
'632541236V',
'576962134V',
'823052316V',
'812352830V',
'545460386V',
'583521860V',
'581390840V',
'598030200V',
'732490850V',
'603481151V',
'620852248V',
'596000690V',
'725741049V',
'756590995V',
'832640980V',
'820671384V',
'840043479V',
'821830710V',
'842022738V',
'912193101V',
'815552245V',
'532220777V',
'835980944V',
'638260808V',
'758041794V',
'686660893V',
'591192744V',
'550210835V',
'785150910V',
'621172336V',
'633112770V',
'703412785V',
'602771984V',
'631641334V',
'621853848V',
'620772526V',
'572381340V',
'562394338V',
'592580442V',
'600514091V',
'613572872V',
'573663691V',
'600820311V',
'591413430V',
'630703093V',
'623660095V',
'603160916V',
'561220280V',
'750183000V',
'570311387V',
'641520560V',
'851201254V',
'768000778V',
'646212014V',
'767762127V',
'588470768V',
'595331811V',
'543361623V',
'625971497V',
'838572170V',
'870560630V',
'831281251V',
'612430438V',
'667501920V',
'646170311V',
'597050887V',
'593234070V',
'837640687V',
'630922372V',
'590490792V',
'842542014V',
'675791228V',
'630922011V',
'530672085V',
'571190931V',
'773000824V',
'572431380V',
'583630392V',
'715681757V',
'610355293V',
'596910300V',
'563081597V',
'617100967V',
'647761321V',
'576371497V',
'630483808V',
'605530605V',
'546723020V',
'591163501V',
'572720489V',
'633440085V',
'653602634V',
'622673320V',
'610290906V',
'580940218V',
'612432503V',
'610710239V',
'698220538V',
'611680082X',
'622633469V',
'610870163V',
'591580965V',
'632850506V',
'580652247V',
'573531507V',
'556030715V',
'657530093V',
'841880234V',
'567851311V',
'642880705V',
'592812169V',
'597070349V',
'676261010V',
'561832196V',
'543191728V',
'656270519V',
'613133810V',
'591003593V',
'587800837V',
'827000400V',
'865212224V',
'617740630V',
'821360080V',
'581410379V',
'770532051V',
'611171781V',
'627172176V',
'590200433V',
'661551968V',
'597150342V',
'592630869V',
'560890133V',
'612322883V',
'845052166V',
'577831025V',
'658241770V',
'801041833V',
'647381006V',
'661584319V',
'665410730V',
'603414829V',
'880740482V',
'716122743V',
'772510659V',
'835884122V',
'873290471V',
'571050692V',
'786691168V',
'585480517V',
'595720427V',
'680683760V',
'623481298V',
'585110981V',
'610904327V',
'647410596V',
'570764314V',
'740433482V',
'755650358V',
'625120055V',
'565731785V',
'576982348V',
'881320037V',
'701450035V',
'556743215V',
'577543755V',
'563210826V',
'581020147V',
'855742527V',
'561251975V',
'577570671V',
'651141842X',
'822785018V',
'838550100V',
'582292230V',
'810850183V',
'571270080X',
'607070059V',
'575340911V',
'742400999V',
'862312872V',
'612810265V',
'612912793V',
'592821346V',
'572670988V',
'627090129V',
'852920475V',
'555041683V',
'661760630V',
'531161297V',
'570430394V',
'847500077V',
'627590776V',
'846671315V',
'586251783V',
'615341193V',
'551112233V',
'618461157V',
'645290127V',
'791290457V',
'613581804V',
'570111000V',
'541572449V',
'570060015V',
'533561551V',
'543353094V',
'532564557V',
'888083405V',
'878360354V',
'565770152V',
'611154950V',
'561160937V',
'717251784V',
'566191296V',
'621720112V',
'832572110V',
'647511511V',
'560210302V',
'560900074V',
'537341424V',
'580631134V',
'588651258V',
'560762445V',
'560702329V',
'553141427V',
'551920992V',
'560661150V',
'580240917V',
'783512530V',
'631391095V',
'715633000V',
'563211261V',
'772661337V',
'573512413V',
'801880258V',
'681591125V',
'623661369V',
'550192560V',
'582430918V',
'616591070V',
'735692917V',
'627510640V',
'580212158V',
'705080593V',
'611650082X',
'601162067V',
'608420444X',
'838083668V',
'803010471V',
'543040614V',
'871130566V',
'610794378V',
'633640165V',
'532930782X',
'872360247V',
'770703064V',
'633301239V',
'791120098V',
'632560664V',
'550582104V',
'702171865V',
'693090059V',
'680321256V',
'618620530X',
'600100483V',
'552691741V',
'660202188V',
'690414538V',
'922300933V',
'856311368V',
'760460567V',
'732670475V',
'561931011V',
'571251485V',
'563452277V',
'660503390V',
'747003475V',
'571980533V',
'608150196V',
'600630580V',
'857322304V',
'886803478V',
'876670461V',
'887953317V',
'888470425V',
'887050740V',
'877733009V',
'887651248V',
'887900752V',
'847100079V',
'866172625V',
'842480698V',
'892101183V',
'913000790V',
'856932826V',
'866710805V',
'872213783V',
'781862720V',
'818281870V',
'788132859V',
'925662690V',
'797312894V')";

$stmt = sqlsrv_query( $conn, $sql );
if( $stmt === false) {
    die( print_r( sqlsrv_errors(), true) );
}

while( $row = sqlsrv_fetch_array( $stmt, SQLSRV_FETCH_ASSOC))	 {

$client = new nusoap_client('https://103.11.35.8/MahaweliHRM/webservice/server.php?wsdl');
$client->soap_defencoding = 'UTF-8';
$client->debug_flag = false;
$soapError = $client->getError();

$clk_date=$row['Date'];
$clk_time=$row['Time'];
$clk_no=$row['NICnumber'];

//die(print_r($clk_no.$clk_date.$clk_time));
//$response = $client->call('setInsertAttendanceRow',array("clk_no" => $clk_no, "clk_date" => $clk_date, "clk_time" => $clk_time));
//if($response){    
//    echo("\n"."Success : ".$clk_no."|".$clk_date."|".$clk_time);
//    }else{
//    echo("\n"."Error: ".$clk_no."|".$clk_date."|".$clk_time);
//}

}

sqlsrv_free_stmt( $stmt);

?>
</body>
</html>
